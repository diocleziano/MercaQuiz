<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MercaQuiz.MVVM.Views.HomePage"
             xmlns:vm="clr-namespace:MercaQuiz.MVVM.ViewModels"
             xmlns:converters="clr-namespace:MercaQuiz.Converters"
             xmlns:models="clr-namespace:MercaQuiz.MVVM.Models"
             x:DataType="vm:MaterieViewModel"
             Title="MercaQuiz">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Aggiungi"
                     Priority="0"
                     Order="Primary"
                     Command="{Binding AggiungiCommand}" />
    </ContentPage.ToolbarItems>

    <ContentPage.Content>
        <Grid RowDefinitions="Auto,*" Padding="16">
            <Label Text="Materie" FontSize="24" FontAttributes="Bold" />
            <CollectionView Grid.Row="1"
                            ItemsSource="{Binding Materie}"
                            SelectionMode="None">
                <CollectionView.EmptyView>
                    <VerticalStackLayout Padding="24" Spacing="8" HorizontalOptions="Center" VerticalOptions="Center">
                        <Label Text="Nessuna materia" FontAttributes="Bold" />
                        <Label Text="Tocca Aggiungi per creare la prima materia." />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Materia">
                        <Border Margin="0,8" Padding="12">
                            <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="8" RowSpacing="8">
                                <Border Grid.RowSpan="2"
                                    WidthRequest="44" HeightRequest="44"
                                    BackgroundColor="Transparent"
                                    Stroke="{Binding ColoreHex, Converter={StaticResource HexToColorConverter}}"
                                    StrokeThickness="2">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="22" />
                                    </Border.StrokeShape>
                                    <Grid>
                                        <Label Text="{Binding Icona}" FontSize="22"
                                            HorizontalOptions="Center" VerticalOptions="Center"
                                            TextColor="{Binding ColoreHex, Converter={StaticResource HexToColorConverter}}">
                                            <Label.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding Icona}" Value="{x:Null}">
                                                    <Setter Property="Text" Value="ðŸ“š" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label" Binding="{Binding Icona}" Value="">
                                                    <Setter Property="Text" Value="ðŸ“š" />
                                                </DataTrigger>
                                            </Label.Triggers>
                                        </Label>
                                    </Grid>
                                </Border>
                                <!-- Info materia -->
                                <VerticalStackLayout Grid.Column="1" Grid.RowSpan="2" Spacing="2">
                                    <Label Text="{Binding Nome}" FontAttributes="Bold" FontSize="18"/>
                                    <HorizontalStackLayout Spacing="8">
                                        <Label Text="{Binding Docente}" IsVisible="{Binding Docente, Converter={StaticResource NullToBoolConverter}}"/>
                                        <Label Text="{Binding Facolta}" IsVisible="{Binding Facolta, Converter={StaticResource NullToBoolConverter}}"/>
                                        <Label Text="{Binding AnnoAccademico, StringFormat='Anno {0}'}"
                                               IsVisible="{Binding AnnoAccademico, Converter={StaticResource ZeroToInvisibleConverter}}"/>
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>

                                <!-- Pulsanti -->
                                <HorizontalStackLayout Grid.Column="2" Grid.Row="0" Spacing="6">
                                    <Button Text="Apri"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ApriCommand}"
                                            CommandParameter="{Binding .}"/>
                                    <Button Text="Modifica"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ModificaCommand}"
                                            CommandParameter="{Binding .}"/>
                                    <Button Text="Elimina"
                                            TextColor="Red"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EliminaCommand}"
                                            CommandParameter="{Binding .}"/>
                                </HorizontalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </ContentPage.Content>
</ContentPage>